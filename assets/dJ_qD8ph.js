import{C as u,n as G,h as K,D as A,o as a,c as o,a as e,I as H,J as Z,d as P,y as C,t as h,v as $,K as W,_ as j,L as te,s as se,F as J,M as ae,N as oe,O as Q,Q as ne}from"./B4L-Ye5l.js";const M=u([]);let le=0;const X=()=>({toasts:M,showToast:(_,r="success")=>{const d=le++,i={id:d,message:_,type:r};M.value.push(i),setTimeout(()=>{const f=M.value.findIndex(c=>c.id===d);f!==-1&&M.value.splice(f,1)},3e3)}}),ie={class:"icon",viewBox:"0 0 24 24",width:"24",height:"24"},ce={key:0,fill:"currentColor",d:"M21 15.75c0-.414-.336-.75-.75-.75H3.75a.75.75 0 0 0 0 1.5h16.5a.75.75 0 0 0 .75-.75ZM21 12c0-.414-.336-.75-.75-.75H3.75a.75.75 0 0 0 0 1.5h16.5a.75.75 0 0 0 .75-.75ZM3.75 9h16.5a.75.75 0 0 0 0-1.5H3.75a.75.75 0 0 0 0 1.5Z"},re={key:1,fill:"currentColor",d:"M5.72 5.72a.75.75 0 0 1 1.06 0L12 10.94l5.22-5.22a.75.75 0 1 1 1.06 1.06L13.06 12l5.22 5.22a.75.75 0 1 1-1.06 1.06L12 13.06l-5.22 5.22a.75.75 0 0 1-1.06-1.06L10.94 12 5.72 6.78a.75.75 0 0 1 0-1.06Z"},ue={class:"sidebar-content"},de={class:"tabs"},ve=["onClick"],he={key:0,class:"count"},fe={key:0,class:"tab-content"},me={key:0,class:"loading"},_e={key:1,class:"empty-state"},ge={key:2,class:"pr-list"},pe={class:"pr-header"},ye={class:"pr-number"},be={class:"pr-title"},ke={class:"pr-meta"},Ce={class:"pr-author"},we=["src","alt"],$e={class:"pr-actions"},Pe=["onClick"],Se=["onClick"],Te={key:1,class:"tab-content"},xe={key:0,class:"loading"},Re={key:1,class:"empty-state"},De={key:2,class:"commit-list"},Ie={class:"commit-header"},Fe={class:"commit-message"},Me={class:"commit-meta"},qe={class:"commit-author"},Ue=["src","alt"],Le={class:"commit-date"},Be={class:"commit-actions"},Ee=["onClick"],Ve=["onClick"],Ne={key:2,class:"tab-content"},He={key:0,class:"conflict-resolver"},Ze={class:"conflict-header"},Ke={class:"conflict-diff"},Ge={class:"diff-header"},Ae={class:"diff-content"},Oe={key:0,class:"diff-view current"},ze={key:1,class:"diff-view incoming"},Je={class:"conflict-actions"},Qe={key:1,class:"empty-state"},We=G({__name:"CollaborationSidebar",setup(T){const _=u(!1),r=u("prs"),d=u(!1),i=u([]),f=u([]),c=u(null),v=u("current"),{getPullRequests:y,getCommits:b,resolveConflict:S}=W(),{showToast:w}=X(),q=K(()=>[{id:"prs",label:"Pull Requests",count:i.value.length},{id:"history",label:"History",count:f.value.length},{id:"conflicts",label:"Conflicts",count:i.value.filter(l=>l.mergeable===!1).length}]),D=()=>{_.value=!_.value},U=l=>l.mergeable===!1?"Has Conflicts":l.mergeable===!0?"Ready to Merge":"Checking",L=l=>new Date(l).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),I=l=>{window.open(l,"_blank")},B=l=>{var m,s,p;c.value={file:(m=l.files[0])==null?void 0:m.filename,current:(s=l.files[0])==null?void 0:s.patch,incoming:(p=l.files[0])==null?void 0:p.patch,pr:l},r.value="conflicts"},E=async()=>{if(c.value)try{d.value=!0,await S(c.value.pr.number,c.value.file,v.value==="current"?"ours":"theirs"),w("Conflict resolved successfully!","success"),c.value=null,await F()}catch(l){console.error("Error resolving conflict:",l),w("Failed to resolve conflict. Please try again.","error")}finally{d.value=!1}},k=()=>{c.value=null,v.value="current"},x=async l=>{console.log("View diff for commit:",l.sha)},R=async l=>{console.log("Restore to commit:",l.sha)},F=async()=>{d.value=!0;try{i.value=await y()}catch(l){console.error("Error loading pull requests:",l),w("Failed to load pull requests","error")}finally{d.value=!1}},V=async()=>{d.value=!0;try{f.value=await b()}catch(l){console.error("Error loading commits:",l),w("Failed to load commits","error")}finally{d.value=!1}};return A(async()=>{await Promise.all([F(),V()])}),(l,m)=>(a(),o("div",{class:$(["collaboration-sidebar",{open:_.value}])},[e("button",{class:"toggle-button",onClick:D},[(a(),o("svg",ie,[_.value?(a(),o("path",re)):(a(),o("path",ce))]))]),e("div",ue,[e("div",de,[(a(!0),o(H,null,Z(q.value,s=>(a(),o("button",{key:s.id,class:$(["tab-button",{active:r.value===s.id}]),onClick:p=>r.value=s.id},[P(h(s.label)+" ",1),s.count?(a(),o("span",he,h(s.count),1)):C("",!0)],10,ve))),128))]),r.value==="prs"?(a(),o("div",fe,[d.value?(a(),o("div",me,m[2]||(m[2]=[e("div",{class:"spinner"},null,-1),P(" Loading pull requests... ")]))):i.value.length===0?(a(),o("div",_e," No open pull requests ")):(a(),o("div",ge,[(a(!0),o(H,null,Z(i.value,s=>(a(),o("div",{key:s.number,class:$(["pr-item",{"has-conflicts":s.mergeable===!1}])},[e("div",pe,[e("span",ye,"#"+h(s.number),1),e("span",be,h(s.title),1)]),e("div",ke,[e("span",Ce,[e("img",{src:s.user.avatar_url,alt:s.user.login,class:"author-avatar"},null,8,we),P(" "+h(s.user.login),1)]),e("span",{class:$(["pr-status",s.mergeable_state])},h(U(s)),3)]),e("div",$e,[e("button",{class:"action-button view",onClick:p=>I(s.html_url)}," View on GitHub ",8,Pe),s.mergeable===!1?(a(),o("button",{key:0,class:"action-button resolve",onClick:p=>B(s)}," Resolve Conflicts ",8,Se)):C("",!0)])],2))),128))]))])):C("",!0),r.value==="history"?(a(),o("div",Te,[d.value?(a(),o("div",xe,m[3]||(m[3]=[e("div",{class:"spinner"},null,-1),P(" Loading commit history... ")]))):f.value.length===0?(a(),o("div",Re," No commit history ")):(a(),o("div",De,[(a(!0),o(H,null,Z(f.value,s=>{var p;return a(),o("div",{key:s.sha,class:"commit-item"},[e("div",Ie,[e("span",Fe,h(s.commit.message),1)]),e("div",Me,[e("span",qe,[e("img",{src:(p=s.author)==null?void 0:p.avatar_url,alt:s.commit.author.name,class:"author-avatar"},null,8,Ue),P(" "+h(s.commit.author.name),1)]),e("span",Le,h(L(s.commit.author.date)),1)]),e("div",Be,[e("button",{class:"action-button view",onClick:N=>x(s)}," View Changes ",8,Ee),e("button",{class:"action-button restore",onClick:N=>R(s)}," Restore Version ",8,Ve)])])}),128))]))])):C("",!0),r.value==="conflicts"?(a(),o("div",Ne,[c.value?(a(),o("div",He,[e("div",Ze,[m[4]||(m[4]=e("h3",null,"Resolve Conflicts",-1)),e("p",null,"Choose which changes to keep for "+h(c.value.file),1)]),e("div",Ke,[e("div",Ge,[e("button",{class:$(["diff-button",{active:v.value==="current"}]),onClick:m[0]||(m[0]=s=>v.value="current")}," Current Changes ",2),e("button",{class:$(["diff-button",{active:v.value==="incoming"}]),onClick:m[1]||(m[1]=s=>v.value="incoming")}," Incoming Changes ",2)]),e("div",Ae,[v.value==="current"?(a(),o("pre",Oe,h(c.value.current),1)):(a(),o("pre",ze,h(c.value.incoming),1))])]),e("div",Je,[e("button",{class:"action-button cancel",onClick:k}," Cancel "),e("button",{class:"action-button resolve",onClick:E}," Accept "+h(v.value==="current"?"Current":"Incoming")+" Changes ",1)])])):(a(),o("div",Qe," No conflicts to resolve "))])):C("",!0)])],2))}}),je=j(We,[["__scopeId","data-v-083b5ee8"]]),Xe={class:"editor-wrapper"},Ye={key:1,class:"editor-toolbar"},et={class:"toolbar-left"},tt={class:"file-path"},st={key:0,class:"branch-name"},at={class:"toolbar-right"},ot=["disabled"],nt={key:0},lt={key:1},it=["disabled"],ct={key:2,class:"login-prompt"},rt=["disabled"],ut={key:3,class:"modal-overlay"},dt={class:"modal"},vt={class:"modal-actions"},ht=["disabled"],ft=G({__name:"TiptapEditor",props:{content:{type:String,default:""},filePath:{type:String,required:!0}},emits:["update:content","save"],setup(T,{emit:_}){const r=T,d=_,i=u(r.content),f=u(r.content),c=u(!1),v=u(""),y=u(!1),b=u(null),S=u(!1),w=u(null),{getUser:q,login:D,createFork:U,createBranch:L,saveFile:I,createPullRequest:B,getFileContent:E}=W(),{showToast:k}=X(),x=K(()=>!!w.value),R=K(()=>i.value!==f.value),F=()=>{d("update:content",i.value)},V=()=>{const n=new Date().getTime(),t=Math.random().toString(36).substring(2,8);return`update-${r.filePath.split("/").pop()}-${n}-${t}`},l=async()=>{if(!(!R.value||c.value)){c.value=!0;try{await U();const n=V();await L(n),v.value=n,await I(r.filePath,i.value,`Update ${r.filePath}`),f.value=i.value,k("Changes saved successfully!","success")}catch(n){console.error("Error saving changes:",n),k("Failed to save changes. Please try again.","error")}finally{c.value=!1}}},m=async()=>{if(v.value)try{const n=`Update ${r.filePath}`,t=`This PR updates the content of \`${r.filePath}\`.

Changes made:
${i.value!==f.value?"- Content updated":""}`;await B(v.value,n,t),k("Pull request created successfully!","success")}catch(n){console.error("Error creating PR:",n),k("Failed to create pull request. Please try again.","error")}},s=n=>{var g;const t=(g=n.dataTransfer)==null?void 0:g.files[0];t&&t.type.startsWith("image/")&&(b.value=t)},p=n=>{var g;const t=(g=n.target.files)==null?void 0:g[0];t&&(b.value=t)},N=async()=>{if(b.value){S.value=!0;try{const t=`${new Date().getTime()}-${b.value.name}`,g=`images/${t}`,Y=await I(g,await b.value.arrayBuffer(),`Upload image ${t}`),ee=`![${t}](${Y})`,z=document.querySelector(".markdown-editor").selectionStart;i.value=i.value.slice(0,z)+ee+i.value.slice(z),y.value=!1,k("Image uploaded successfully!","success")}catch(n){console.error("Error uploading image:",n),k("Failed to upload image. Please try again.","error")}finally{S.value=!1,b.value=null}}},O=n=>{(n.ctrlKey||n.metaKey)&&n.key==="s"&&(n.preventDefault(),l()),(n.ctrlKey||n.metaKey)&&n.shiftKey&&n.key==="I"&&(n.preventDefault(),y.value=!0)};return A(async()=>{window.addEventListener("keydown",O);const n=await q();n&&(w.value=n);try{const t=await E(r.filePath);i.value=t,f.value=t}catch(t){console.error("Error loading content:",t),k("Failed to load content. Please try again.","error")}}),te(()=>{window.removeEventListener("keydown",O)}),(n,t)=>(a(),o("div",Xe,[x.value?(a(),se(je,{key:0})):C("",!0),x.value?(a(),o("div",Ye,[e("div",et,[e("span",tt,h(T.filePath),1),v.value?(a(),o("span",st,[t[4]||(t[4]=e("svg",{class:"branch-icon",viewBox:"0 0 16 16",width:"16",height:"16"},[e("path",{fill:"currentColor",d:"M5 5.372v.878c0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75v-.878a2.25 2.25 0 1 1 1.5 0v.878a2.25 2.25 0 0 1-2.25 2.25h-1.5v2.128a2.251 2.251 0 1 1-1.5 0V8.5h-1.5A2.25 2.25 0 0 1 3.5 6.25v-.878a2.25 2.25 0 1 1 1.5 0ZM5 3.25a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0Zm6.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Zm-3 8.75a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0Z"})],-1)),P(" "+h(v.value),1)])):C("",!0)]),e("div",at,[e("button",{class:$(["toolbar-button",{loading:c.value}]),disabled:c.value||!R.value,onClick:l},[c.value?(a(),o("span",lt,"Saving...")):(a(),o("span",nt,"Save Changes"))],10,ot),R.value?(a(),o("button",{key:0,class:"toolbar-button create-pr",disabled:c.value,onClick:m}," Create PR ",8,it)):C("",!0)])])):(a(),o("div",ct,[t[6]||(t[6]=e("p",null,"Please sign in with GitHub to edit this file",-1)),e("button",{class:"login-button",onClick:t[0]||(t[0]=(...g)=>J(D)&&J(D)(...g))},t[5]||(t[5]=[e("svg",{class:"github-icon",viewBox:"0 0 24 24",width:"16",height:"16"},[e("path",{fill:"currentColor",d:"M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"})],-1),P(" Sign in with GitHub ")]))])),ae(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=g=>i.value=g),class:"markdown-editor",onInput:F,placeholder:"Start writing...",disabled:!x.value||c.value},null,40,rt),[[oe,i.value]]),y.value?(a(),o("div",ut,[e("div",dt,[t[8]||(t[8]=e("h3",null,"Upload Image",-1)),e("div",{class:"upload-area",onDrop:Q(s,["prevent"]),onDragover:t[2]||(t[2]=Q(()=>{},["prevent"]))},[e("input",{type:"file",ref:"fileInput",onChange:p,accept:"image/*",class:"file-input"},null,544),t[7]||(t[7]=e("p",null,"Drag and drop an image or click to select",-1))],32),e("div",vt,[e("button",{onClick:t[3]||(t[3]=g=>y.value=!1),class:"cancel-button"},"Cancel"),e("button",{onClick:N,disabled:!b.value||S.value,class:"upload-button"},h(S.value?"Uploading...":"Upload"),9,ht)])])])):C("",!0)]))}}),pt=j(ft,[["__scopeId","data-v-42ba8bc0"]]),mt=Symbol.for("nuxt:client-only"),yt=G({name:"ClientOnly",inheritAttrs:!1,props:["fallback","placeholder","placeholderTag","fallbackTag"],setup(T,{slots:_,attrs:r}){const d=u(!1);return A(()=>{d.value=!0}),ne(mt,!0),i=>{var y;if(d.value)return(y=_.default)==null?void 0:y.call(_);const f=_.fallback||_.placeholder;if(f)return f();const c=i.fallback||i.placeholder||"",v=i.fallbackTag||i.placeholderTag||"span";return o(v,r,c)}}});export{yt as _,pt as a};
