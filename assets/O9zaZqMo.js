import{C as v,n as z,I as x,h as O,D as J,o as a,c as n,a as e,J as G,K as A,d as T,y as C,t as f,v as P,_ as oe,L as le,s as ie,F as te,M as re,N as ce,O as se,Q as ue}from"./Cz1l4GrR.js";const V=v([]);let de=0;const H=()=>({toasts:V,showToast:(_,i="success")=>{const d=de++,p={id:d,message:_,type:i};V.value.push(p),setTimeout(()=>{const u=V.value.findIndex(r=>r.id===d);u!==-1&&V.value.splice(u,1)},3e3)}}),ve={class:"icon",viewBox:"0 0 24 24",width:"24",height:"24"},fe={key:0,fill:"currentColor",d:"M21 15.75c0-.414-.336-.75-.75-.75H3.75a.75.75 0 0 0 0 1.5h16.5a.75.75 0 0 0 .75-.75ZM21 12c0-.414-.336-.75-.75-.75H3.75a.75.75 0 0 0 0 1.5h16.5a.75.75 0 0 0 .75-.75ZM3.75 9h16.5a.75.75 0 0 0 0-1.5H3.75a.75.75 0 0 0 0 1.5Z"},he={key:1,fill:"currentColor",d:"M5.72 5.72a.75.75 0 0 1 1.06 0L12 10.94l5.22-5.22a.75.75 0 1 1 1.06 1.06L13.06 12l5.22 5.22a.75.75 0 1 1-1.06 1.06L12 13.06l-5.22 5.22a.75.75 0 0 1-1.06-1.06L10.94 12 5.72 6.78a.75.75 0 0 1 0-1.06Z"},me={class:"sidebar-content"},_e={class:"tabs"},pe=["onClick"],ge={key:0,class:"count"},be={key:0,class:"tab-content"},ye={key:0,class:"loading"},ke={key:1,class:"empty-state"},Ce={key:2,class:"pr-list"},we={class:"pr-header"},$e={class:"pr-number"},Pe={class:"pr-title"},Te={class:"pr-meta"},Se={class:"pr-author"},Fe=["src","alt"],De={class:"pr-actions"},Re=["onClick"],xe=["onClick"],qe={key:1,class:"tab-content"},Ie={key:0,class:"loading"},Me={key:1,class:"empty-state"},Le={key:2,class:"commit-list"},Ue={class:"commit-header"},Ee={class:"commit-message"},Ne={class:"commit-meta"},Ve={class:"commit-author"},He=["src","alt"],Be={class:"commit-date"},Ze={class:"commit-actions"},Ke=["onClick"],Ge=["onClick"],Ae={key:2,class:"tab-content"},Oe={key:0,class:"conflict-resolver"},ze={class:"conflict-header"},Je={class:"conflict-diff"},Qe={class:"diff-header"},We={class:"diff-content"},je={key:0,class:"diff-view current"},Xe={key:1,class:"diff-view incoming"},Ye={class:"conflict-actions"},et={key:1,class:"empty-state"},tt=z({__name:"CollaborationSidebar",setup(S){const _=v(!1),i=v("prs"),d=v(!1),p=v([]),u=v([]),r=v(null),h=v("current"),{getPullRequests:g,getCommits:B,resolveConflict:b}=x(),{showToast:w}=H(),y=O(()=>[{id:"prs",label:"Pull Requests",count:p.value.length},{id:"history",label:"History",count:u.value.length},{id:"conflicts",label:"Conflicts",count:p.value.filter(l=>l.mergeable===!1).length}]),$=()=>{_.value=!_.value},q=l=>l.mergeable===!1?"Has Conflicts":l.mergeable===!0?"Ready to Merge":"Checking",Z=l=>new Date(l).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),I=l=>{window.open(l,"_blank")},Q=l=>{var m,s,k;r.value={file:(m=l.files[0])==null?void 0:m.filename,current:(s=l.files[0])==null?void 0:s.patch,incoming:(k=l.files[0])==null?void 0:k.patch,pr:l},i.value="conflicts"},W=async()=>{if(r.value)try{d.value=!0,await b(r.value.pr.number,r.value.file,h.value==="current"?"ours":"theirs"),w("Conflict resolved successfully!","success"),r.value=null,await M()}catch(l){console.error("Error resolving conflict:",l),w("Failed to resolve conflict. Please try again.","error")}finally{d.value=!1}},j=()=>{r.value=null,h.value="current"},F=async l=>{console.log("View diff for commit:",l.sha)},D=async l=>{console.log("Restore to commit:",l.sha)},M=async()=>{d.value=!0;try{p.value=await g()}catch(l){console.error("Error loading pull requests:",l),w("Failed to load pull requests","error")}finally{d.value=!1}},L=async()=>{d.value=!0;try{u.value=await B()}catch(l){console.error("Error loading commits:",l),w("Failed to load commits","error")}finally{d.value=!1}};return J(async()=>{await Promise.all([M(),L()])}),(l,m)=>(a(),n("div",{class:P(["collaboration-sidebar",{open:_.value}])},[e("button",{class:"toggle-button",onClick:$},[(a(),n("svg",ve,[_.value?(a(),n("path",he)):(a(),n("path",fe))]))]),e("div",me,[e("div",_e,[(a(!0),n(G,null,A(y.value,s=>(a(),n("button",{key:s.id,class:P(["tab-button",{active:i.value===s.id}]),onClick:k=>i.value=s.id},[T(f(s.label)+" ",1),s.count?(a(),n("span",ge,f(s.count),1)):C("",!0)],10,pe))),128))]),i.value==="prs"?(a(),n("div",be,[d.value?(a(),n("div",ye,m[2]||(m[2]=[e("div",{class:"spinner"},null,-1),T(" Loading pull requests... ")]))):p.value.length===0?(a(),n("div",ke," No open pull requests ")):(a(),n("div",Ce,[(a(!0),n(G,null,A(p.value,s=>(a(),n("div",{key:s.number,class:P(["pr-item",{"has-conflicts":s.mergeable===!1}])},[e("div",we,[e("span",$e,"#"+f(s.number),1),e("span",Pe,f(s.title),1)]),e("div",Te,[e("span",Se,[e("img",{src:s.user.avatar_url,alt:s.user.login,class:"author-avatar"},null,8,Fe),T(" "+f(s.user.login),1)]),e("span",{class:P(["pr-status",s.mergeable_state])},f(q(s)),3)]),e("div",De,[e("button",{class:"action-button view",onClick:k=>I(s.html_url)}," View on GitHub ",8,Re),s.mergeable===!1?(a(),n("button",{key:0,class:"action-button resolve",onClick:k=>Q(s)}," Resolve Conflicts ",8,xe)):C("",!0)])],2))),128))]))])):C("",!0),i.value==="history"?(a(),n("div",qe,[d.value?(a(),n("div",Ie,m[3]||(m[3]=[e("div",{class:"spinner"},null,-1),T(" Loading commit history... ")]))):u.value.length===0?(a(),n("div",Me," No commit history ")):(a(),n("div",Le,[(a(!0),n(G,null,A(u.value,s=>{var k;return a(),n("div",{key:s.sha,class:"commit-item"},[e("div",Ue,[e("span",Ee,f(s.commit.message),1)]),e("div",Ne,[e("span",Ve,[e("img",{src:(k=s.author)==null?void 0:k.avatar_url,alt:s.commit.author.name,class:"author-avatar"},null,8,He),T(" "+f(s.commit.author.name),1)]),e("span",Be,f(Z(s.commit.author.date)),1)]),e("div",Ze,[e("button",{class:"action-button view",onClick:K=>F(s)}," View Changes ",8,Ke),e("button",{class:"action-button restore",onClick:K=>D(s)}," Restore Version ",8,Ge)])])}),128))]))])):C("",!0),i.value==="conflicts"?(a(),n("div",Ae,[r.value?(a(),n("div",Oe,[e("div",ze,[m[4]||(m[4]=e("h3",null,"Resolve Conflicts",-1)),e("p",null,"Choose which changes to keep for "+f(r.value.file),1)]),e("div",Je,[e("div",Qe,[e("button",{class:P(["diff-button",{active:h.value==="current"}]),onClick:m[0]||(m[0]=s=>h.value="current")}," Current Changes ",2),e("button",{class:P(["diff-button",{active:h.value==="incoming"}]),onClick:m[1]||(m[1]=s=>h.value="incoming")}," Incoming Changes ",2)]),e("div",We,[h.value==="current"?(a(),n("pre",je,f(r.value.current),1)):(a(),n("pre",Xe,f(r.value.incoming),1))])]),e("div",Ye,[e("button",{class:"action-button cancel",onClick:j}," Cancel "),e("button",{class:"action-button resolve",onClick:W}," Accept "+f(h.value==="current"?"Current":"Incoming")+" Changes ",1)])])):(a(),n("div",et," No conflicts to resolve "))])):C("",!0)])],2))}}),st=oe(tt,[["__scopeId","data-v-083b5ee8"]]),ot={class:"editor-wrapper"},at={key:1,class:"editor-toolbar"},nt={class:"toolbar-left"},lt={class:"file-path"},it={key:0,class:"branch-name"},rt={class:"toolbar-right"},ct=["disabled"],ut={key:0},dt={key:1},vt=["disabled"],ft={key:2,class:"login-prompt"},ht=["disabled"],mt={key:3,class:"modal-overlay"},_t={class:"modal"},pt={class:"modal-actions"},gt=["disabled"],bt=z({__name:"TiptapEditor",props:{content:{type:String,default:""},filePath:{type:String,required:!0}},emits:["update:content","save"],setup(S,{emit:_}){const{showToast:i}=H(),{saveFile:d,getFileContent:p}=x(),u=v(null),r=v(!1),h=v(!1),g=S,B=_,b=v(g.content),w=v(g.content),y=v(!1),$=v(""),q=v(null),{getUser:Z,login:I,createFork:Q,createBranch:W,createPullRequest:j}=x(),F=O(()=>!!q.value),D=O(()=>b.value!==w.value),M=()=>{B("update:content",b.value)},L=async()=>{if(!D.value||y.value)return;y.value=!0;const{showToast:o}=H();x();try{const t=new Date().getTime(),c=Math.random().toString(36).substring(2,8),U=`update-${g.filePath.split("/").pop()}-${t}-${c}`;await l(g.filePath,b.value)?(o("Content saved successfully","success"),w.value=b.value):o("Failed to save content","error")}catch(t){console.error("Error saving content:",t),o("Failed to save content","error")}finally{y.value=!1}},l=async(o,t)=>{try{const c=new Date().getTime(),U=Math.random().toString(36).substring(2,8),R=`update-${o.split("/").pop()}-${c}-${U}`;return await d("tiresomefanatic","heroechotemp",o,t,`Update ${o}`,R)?($.value=R,i("File saved successfully","success"),!0):(i("Failed to save file","error"),!1)}catch(c){return console.error("Error saving file:",c),i("Failed to save file","error"),!1}},m=async()=>{if(!$.value)return;const{showToast:o}=H(),{createPullRequest:t}=x();try{await t("tiresomefanatic","heroechotemp","main",$.value,`Update ${g.filePath}`,`This PR updates the content of ${g.filePath}`)?o("Pull request created successfully","success"):o("Failed to create pull request","error")}catch(c){console.error("Error creating PR:",c),o("Failed to create pull request","error")}},s=o=>{var c;const t=(c=o.dataTransfer)==null?void 0:c.files[0];t&&t.type.startsWith("image/")&&(u.value=t)},k=o=>{var c;const t=(c=o.target.files)==null?void 0:c[0];t&&(u.value=t)},K=async()=>{if(!u.value){i("Please select a file first","error");return}if(r.value=!0,!u.value){r.value=!1;return}try{if(!u.value){console.error("No file selected");return}const o=u.value,t=new FileReader;t.readAsDataURL(o),t.onload=async()=>{var Y;const U=t.result.split(",")[1],R=new Date().getTime(),E=`${o.name}-${R}`,ae=`images/${E}`,N=await d("tiresomefanatic","heroechotemp",ae,U,`Upload image ${E}`,"main");if((Y=N==null?void 0:N.content)!=null&&Y.download_url){const ne=`![${E}](${N.content.download_url})`,ee=document.querySelector(".markdown-editor").selectionStart;b.value=b.value.slice(0,ee)+ne+b.value.slice(ee),h.value=!1,i("Image uploaded successfully!","success")}else i("Failed to upload image","error")}}catch(o){console.error("Error uploading image:",o),i("Failed to upload image","error")}finally{r.value=!1}},X=o=>{(o.ctrlKey||o.metaKey)&&o.key==="s"&&(o.preventDefault(),L()),(o.ctrlKey||o.metaKey)&&o.shiftKey&&o.key==="I"&&(o.preventDefault(),h.value=!0)};return J(async()=>{window.addEventListener("keydown",X);const o=await Z();o&&(q.value=o);try{const t=await p("tiresomefanatic","heroechotemp",g.filePath);t?(b.value=t,w.value=t):i("No content found for this file.","error")}catch(t){console.error("Error loading content:",t),i("Failed to load content. Please try again.","error")}}),le(()=>{window.removeEventListener("keydown",X)}),(o,t)=>(a(),n("div",ot,[F.value?(a(),ie(st,{key:0})):C("",!0),F.value?(a(),n("div",at,[e("div",nt,[e("span",lt,f(S.filePath),1),$.value?(a(),n("span",it,[t[4]||(t[4]=e("svg",{class:"branch-icon",viewBox:"0 0 16 16",width:"16",height:"16"},[e("path",{fill:"currentColor",d:"M5 5.372v.878c0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75v-.878a2.25 2.25 0 1 1 1.5 0v.878a2.25 2.25 0 0 1-2.25 2.25h-1.5v2.128a2.251 2.251 0 1 1-1.5 0V8.5h-1.5A2.25 2.25 0 0 1 3.5 6.25v-.878a2.25 2.25 0 1 1 1.5 0ZM5 3.25a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0Zm6.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Zm-3 8.75a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0Z"})],-1)),T(" "+f($.value),1)])):C("",!0)]),e("div",rt,[e("button",{class:P(["toolbar-button",{loading:y.value}]),disabled:y.value||!D.value,onClick:L},[y.value?(a(),n("span",dt,"Saving...")):(a(),n("span",ut,"Save Changes"))],10,ct),D.value?(a(),n("button",{key:0,class:"toolbar-button create-pr",disabled:y.value,onClick:m}," Create PR ",8,vt)):C("",!0)])])):(a(),n("div",ft,[t[6]||(t[6]=e("p",null,"Please sign in with GitHub to edit this file",-1)),e("button",{class:"login-button",onClick:t[0]||(t[0]=(...c)=>te(I)&&te(I)(...c))},t[5]||(t[5]=[e("svg",{class:"github-icon",viewBox:"0 0 24 24",width:"16",height:"16"},[e("path",{fill:"currentColor",d:"M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"})],-1),T(" Sign in with GitHub ")]))])),re(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=c=>b.value=c),class:"markdown-editor",onInput:M,placeholder:"Start writing...",disabled:!F.value||y.value},null,40,ht),[[ce,b.value]]),h.value?(a(),n("div",mt,[e("div",_t,[t[8]||(t[8]=e("h3",null,"Upload Image",-1)),e("div",{class:"upload-area",onDrop:se(s,["prevent"]),onDragover:t[2]||(t[2]=se(()=>{},["prevent"]))},[e("input",{type:"file",ref:"fileInput",onChange:k,accept:"image/*",class:"file-input"},null,544),t[7]||(t[7]=e("p",null,"Drag and drop an image or click to select",-1))],32),e("div",pt,[e("button",{onClick:t[3]||(t[3]=c=>h.value=!1),class:"cancel-button"},"Cancel"),e("button",{onClick:K,disabled:!u.value||r.value,class:"upload-button"},f(r.value?"Uploading...":"Upload"),9,gt)])])])):C("",!0)]))}}),wt=oe(bt,[["__scopeId","data-v-fa7c0cb7"]]),yt=Symbol.for("nuxt:client-only"),$t=z({name:"ClientOnly",inheritAttrs:!1,props:["fallback","placeholder","placeholderTag","fallbackTag"],setup(S,{slots:_,attrs:i}){const d=v(!1);return J(()=>{d.value=!0}),ue(yt,!0),p=>{var g;if(d.value)return(g=_.default)==null?void 0:g.call(_);const u=_.fallback||_.placeholder;if(u)return u();const r=p.fallback||p.placeholder||"",h=p.fallbackTag||p.placeholderTag||"span";return n(h,i,r)}}});export{$t as _,wt as a};
